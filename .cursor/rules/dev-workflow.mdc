# Fluxo de Desenvolvimento - User Contact

## **Contexto Inicial**

-   **Tarefa**: Pode ser fornecida diretamente ou obtida via Taskmaster MCP
-   **Objetivo**: Seguir rigorosamente o fluxo padronizado abaixo

## **Etapas Obrigatórias**

### **1. Análise e Planejamento**

-   **Compreender** o escopo completo da tarefa
-   **Criar** um plano de ação detalhado
-   **Identificar** dependências e requisitos técnicos
-   **Localizar** arquivos relevantes usando Serena MCP
-   **Analisar** código existente com busca de símbolos
-   **Obter** tarefa do Taskmaster se não fornecida diretamente

### **2. Preparação do Ambiente**

-   **Criar** feature branch isolada: `git checkout -b feature/nome-da-tarefa`
-   **Verificar** status do repositório: `git status`

### **3. Início da Tarefa (Taskmaster)**

-   **Marcar** tarefa como "in-progress" no Taskmaster:

    ```bash
    # Via MCP Tool
    set_task_status(id="ID_DA_TAREFA", status="in-progress")

    # Via CLI
    task-master set-status --id=ID_DA_TAREFA --status=in-progress
    ```

-   **Verificar** dependências da tarefa se houver

### **4. Quality Assurance Pré-Desenvolvimento**

-   **Executar** scripts de QA para validar estado inicial:
    ```bash
    vendor/bin/pint --dirty
    php artisan test
    ```
-   **Garantir** que não há problemas prévios no código

### **5. Desenvolvimento**

-   **Implementar** a solução seguindo as especificações
-   **Seguir** padrões de código do projeto
-   **Documentar** mudanças significativas
-   **Utilizar Serena MCP** para localização eficiente de arquivos e símbolos
-   **Aplicar modificações** usando Regular Expressions quando apropriado
-   **Atualizar** progresso na tarefa se necessário:

    ```bash
    # Via MCP Tool
    update_subtask(id="ID_DA_TAREFA", prompt="Progresso: implementação concluída...")

    # Via CLI
    task-master update-subtask --id=ID_DA_TAREFA --prompt="Progresso: implementação concluída..."
    ```

### **6. Quality Assurance Pós-Desenvolvimento**

-   **Executar** novamente os scripts de QA:
    ```bash
    vendor/bin/pint --dirty
    php artisan test
    ```
-   **Validar** que o desenvolvimento atende aos padrões de qualidade

### **7. Commit e Versionamento**

-   **Adicionar** arquivos modificados: `git add .`
-   **Criar** commit descritivo: `git commit -m "feat: descrição clara da implementação"`
-   **Push** para repositório: `git push origin feature/nome-da-tarefa`

### **8. Finalização da Tarefa (Taskmaster)**

-   **Marcar** tarefa como "done" no Taskmaster:

    ```bash
    # Via MCP Tool
    set_task_status(id="ID_DA_TAREFA", status="done")

    # Via CLI
    task-master set-status --id=ID_DA_TAREFA --status=done
    ```

-   **Atualizar** detalhes finais da tarefa:

    ```bash
    # Via MCP Tool
    update_task(id="ID_DA_TAREFA", prompt="Implementação finalizada com sucesso. Principais mudanças: ...")

    # Via CLI
    task-master update-task --id=ID_DA_TAREFA --prompt="Implementação finalizada com sucesso. Principais mudanças: ..."
    ```

### **9. Documentação e Log**

-   **Fazer switch** para o projeto user-contact no Basic Memory MCP:

    ```bash
    # Via MCP Tool
    switch_project(project_name="user-contact")

    # Via CLI
    basic-memory switch-project user-contact
    ```

-   **Utilizar** Basic Memory MCP projeto user-contact para registrar:
    -   Tarefa completada
    -   Principais mudanças implementadas
    -   Decisões técnicas tomadas
    -   Próximos passos (se houver)

## **Comandos de Referência**

### **Taskmaster MCP Tools**

```bash
# Obter tarefa atual
get_task(id="ID_DA_TAREFA")

# Marcar como in-progress
set_task_status(id="ID_DA_TAREFA", status="in-progress")

# Marcar como done
set_task_status(id="ID_DA_TAREFA", status="done")

# Atualizar progresso
update_subtask(id="ID_DA_TAREFA", prompt="Progresso: ...")

# Atualizar detalhes finais
update_task(id="ID_DA_TAREFA", prompt="Implementação finalizada...")
```

### **Taskmaster CLI Commands**

```bash
# Obter tarefa atual
task-master show ID_DA_TAREFA

# Marcar como in-progress
task-master set-status --id=ID_DA_TAREFA --status=in-progress

# Marcar como done
task-master set-status --id=ID_DA_TAREFA --status=done

# Atualizar progresso
task-master update-subtask --id=ID_DA_TAREFA --prompt="Progresso: ..."

# Atualizar detalhes finais
task-master update-task --id=ID_DA_TAREFA --prompt="Implementação finalizada..."
```

### **Basic Memory MCP Tools**

```bash
# Fazer switch para projeto user-contact
switch_project(project_name="user-contact")

# Verificar projeto atual
get_current_project()

# Listar projetos disponíveis
list_memory_projects()

# Escrever nota no projeto atual
write_note(title="Título da Nota", content="Conteúdo...", folder="tarefas")
```

### **Basic Memory CLI Commands**

```bash
# Fazer switch para projeto user-contact
basic-memory switch-project user-contact

# Verificar projeto atual
basic-memory get-current-project

# Listar projetos disponíveis
basic-memory list-projects

# Escrever nota
basic-memory write-note --title="Título da Nota" --content="Conteúdo..." --folder="tarefas"
```

### **Serena MCP Tools**

```bash
# Localizar arquivos por padrão
glob_file_search(glob_pattern="*.php", target_directory="app/")

# Buscar símbolos específicos (classes, funções, métodos)
grep(pattern="class.*Controller", path="app/Http/Controllers/")

# Buscar com contexto (linhas antes e depois)
grep(pattern="function.*test", path="tests/", -A=3, -B=2)

# Buscar em múltiplos tipos de arquivo
grep(pattern="Route::", type="php", path="routes/")

# Buscar apenas nomes de arquivos que correspondem ao padrão
grep(pattern=".*", path="app/", output_mode="files_with_matches")

# Contar ocorrências
grep(pattern="use.*Illuminate", path="app/", output_mode="count")

# Buscar com regex complexa
grep(pattern="public function \w+\(.*\): \w+", path="app/Models/", multiline=true)

# Buscar em arquivos específicos
grep(pattern="protected \$fillable", path="app/Models/User.php")

# Buscar com case insensitive
grep(pattern="laravel", path="composer.json", -i=true)
```

### **Casos de Uso Serena MCP**

#### **Localização de Arquivos**

-   **Buscar** arquivos por extensão: `glob_file_search(glob_pattern="*.php")`
-   **Encontrar** arquivos específicos: `glob_file_search(glob_pattern="*Controller.php")`
-   **Localizar** arquivos de configuração: `glob_file_search(glob_pattern="*.neon")`

#### **Busca de Símbolos**

-   **Classes**: `grep(pattern="^class \w+", path="app/")`
-   **Métodos**: `grep(pattern="public function \w+", path="app/")`
-   **Imports**: `grep(pattern="^use ", path="app/")`
-   **Constantes**: `grep(pattern="const \w+", path="app/")`

#### **Análise de Código**

-   **Relacionamentos**: `grep(pattern="hasMany|belongsTo", path="app/Models/")`
-   **Validações**: `grep(pattern="rules\(\)", path="app/Http/Requests/")`
-   **Middleware**: `grep(pattern="middleware", path="app/Http/")`

#### **Modificações com Regex**

-   **Renomear** métodos: Use regex para encontrar padrões e aplicar mudanças consistentes
-   **Refatorar** imports: Localizar e atualizar imports usando padrões regex
-   **Padronizar** formatação: Aplicar mudanças de formatação usando regex
-   **Atualizar** sintaxe: Modernizar código usando padrões regex específicos

### **Melhores Práticas Serena MCP**

#### **Quando Usar Serena MCP**

-   **Antes de implementar**: Para entender estrutura existente
-   **Durante refatoração**: Para localizar padrões a serem modificados
-   **Para análise**: Para encontrar dependências e relacionamentos
-   **Para debugging**: Para localizar problemas específicos no código

#### **Estratégias de Busca Eficientes**

-   **Começar amplo**: Use `glob_file_search` para encontrar arquivos relevantes
-   **Refinar busca**: Use `grep` com padrões específicos
-   **Usar contexto**: Adicione `-A` e `-B` para ver linhas adjacentes
-   **Combinar ferramentas**: Use `codebase_search` + `grep` para análise completa

#### **Regex Patterns Úteis**

-   **Classes**: `^class \w+`
-   **Métodos**: `(public|private|protected) function \w+`
-   **Imports**: `^use [A-Z]`
-   **Relacionamentos**: `(hasMany|belongsTo|hasOne|belongsToMany)`
-   **Validações**: `rules\(\)|validate\(\)`
-   **Rotas**: `Route::(get|post|put|delete)`

### **QA Scripts**

```bash
# Formatação de código
vendor/bin/pint --dirty

# Testes
php artisan test

# Verificação de sintaxe (se aplicável)
php -l arquivo.php
```

### **Git Workflow**

```bash
# Criar branch
git checkout -b feature/nome-da-tarefa

# Status e adicionar mudanças
git status
git add .

# Commit e push
git commit -m "feat: descrição da mudança"
git push origin feature/nome-da-tarefa
```

## **Critérios de Sucesso**

-   ✅ Tarefa marcada como "in-progress" no início
-   ✅ Serena MCP utilizado para localização eficiente de arquivos/símbolos
-   ✅ Modificações aplicadas usando regex quando apropriado
-   ✅ Código formatado corretamente (Pint)
-   ✅ Todos os testes passando
-   ✅ Feature branch criada e isolada
-   ✅ Commit descritivo realizado
-   ✅ Tarefa marcada como "done" no final
-   ✅ Projeto user-contact ativo no Basic Memory
-   ✅ Log registrado no Basic Memory

## **Exceções e Problemas**

-   **Se QA falhar**: Corrigir problemas antes de prosseguir
-   **Se testes falharem**: Investigar e corrigir antes do commit
-   **Se houver conflitos**: Resolver antes de continuar o desenvolvimento
-   **Se tarefa não existir**: Criar nova tarefa via Taskmaster antes de iniciar
-   **Se dependências não estiverem prontas**: Aguardar ou reordenar tarefas

-   **Se QA falhar**: Corrigir problemas antes de prosseguir
-   **Se testes falharem**: Investigar e corrigir antes do commit
-   **Se houver conflitos**: Resolver antes de continuar o desenvolvimento
